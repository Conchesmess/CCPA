{% extends 'base.html' %}

{% block body %}

<div class="container">
    <div class="row bg-light border border-3 p-3 mb-3">
        <div class="col-4">
            <h2>
                {% if plan.student.aeriesid %}
                    Success Plan <br> <a href="/profile/{{plan.student.aeriesid}}">{{plan.student.afname}} {{plan.student.alname}}</a> 
                {% else %}
                    Success Plan <br> <a href="/profile">{{plan.student.afname}} {{plan.student.alname}}</a> 
                {% endif %}
            </h2>
        </div>
        <div class="col-4">
            <h6>
                Plan Status: 
                {% if status == 2 %}
                <font color="green">Complete</font>
                {% elif status == 1 %}
                <font color="orange"><br>Add at least 3 Ideal Outcomes</font>
                {% elif status == 0 %}
                    <br>Create a Theme and add at least 3 Ideal Outcomes
                {% endif %}
                {% if numActiveThemes > 1 %}
                    <br><br><font color="Orange"><i>You have more than one active theme. Please please edit old themes.</i></font>
                {% endif %}
            </h6>
        </div>
        <div class="col-4">
            <h6>
                Time: {{settings.timeframe}}
                {% if session['isadmin'] %}
                    <a href="/plansettings"><img width="20" src="/static/edit.png"></a>
                {% endif %}
            </h6>
            <h6>Current: <span id="settingstf"> </span></h6>
        </div>
    </div>

    <div class="row">
        <div class="col-12 bg-light border border-2 p-3 mb-3">
            <h2>
                Theme
                {% if numActiveThemes == 0 %}
                    <a href="/planthemenew/{{plan.id}}"><img width="30" src="/static/new.png"></a>
                {% endif %}
            </h2>
            <a href="#themevideo"> What is a theme?</a>
        </div>
        {% if plan.themes %}
            {% for theme in plan.themes %}
            {% if not theme.old %}
                <div class="col-md-4 ps-3">
                    <h3>
                        <span id="settingstf2"> </span> of {{ theme.name }} <br>
                        {% if plan.student.gid == session.gid or session.isadmin %}
                            <a href="/planthemeedit/{{plan.id}}/{{theme.oid}}"><img width="30" src="/static/edit.png"></a>
                            <a href="/planthemedelete/{{plan.id}}/{{theme.oid}}"><img width="30" src="/static/delete.png"></a>
                        {% endif %}
                    </h3>
                </div>
                <div class="col-md-8">
                    {{ theme.description }}
                </div>
                <div class="col-12 ms-3 bg-light border border-2 my-3">
                    <h5>
                        Ideal Outcomes
                        <a href="/planidealoutcomenew/{{plan.id}}/{{theme.oid}}"><img width="20" src="/static/new.png"></a>
                    </h5>
                    <em>An ideal outcome is something that will result from practice, effort and attention to <strong>{{theme.name}}</strong> over the course of a <b>{{theme.timeframe}}</b>.</em>
                    
                </div>
 {{ moment().diff(lastCheckin.createdate) }}

                {% if theme.idealoutcomes %}
                    {% for idealoutcome in theme.idealoutcomes %}
                        <div class="col-md-4 ms-3 ps-5">
                            <b>{{idealoutcome.name}}</b> <br> <small><b>Example<img width="20" src="/static/checkin.png">:</b> {{idealoutcome.example}}</small>
                            {% if plan.student.gid == session.gid or session.isadmin %}
                            <br>

                            <a data-toggle="tooltip" data-placement="top" title="Checkin" href="/plancheckin/{{plan.student.gid}}/{{theme.oid}}/{{idealoutcome.oid}}">
                                <img width="30" src="/static/checkin.png">
                            </a>
                            <a data-toggle="tooltip" data-placement="top" title="Edit" href="/planidealoutcomeedit/{{plan.id}}/{{theme.oid}}/{{idealoutcome.oid}}"><img width="30" src="/static/edit.png"></a>
                            <a data-toggle="tooltip" data-placement="top" title="Delete" href="/planidealoutcomedelete/{{plan.id}}/{{theme.oid}}/{{idealoutcome.oid}}"><img width="30" src="/static/delete.png"></a>
                            {% endif %}
                        </div>
                        <div class="col-md-7">
                            {{idealoutcome.description}} <br>
                            <hr>
                        </div>
                    {% endfor %}
                {% else %}
                <div class="col-12 ms-3 ps-5">
                    <h5>
                        <font color="orange">You have no Ideal Outcomes yet for this theme.</font> Click <a href="/planidealoutcomenew/{{plan.id}}/{{theme.oid}}"><img width="20" src="/static/new.png"></a>
                        to create on now!
                    </h5>
                </div>
                {% endif %}
            {% endif %}
            {% endfor %}
            <div class="col-12">
                <div class="row">
                    <div class="col-12"><h5>Checkins</h5></div>
                    
                {% for checkin in checkins %}
                    <div class="col">
                        <b>{{moment(checkin.createdate).calendar()}}</b> <br>
                        <b>Focus:</b> {{checkin.todayfocus}} <br>
                        <b>I said I would:</b> {{checkin.todaynarrative}} <br>
                        {% if checkin.yesterdayrating %}
                        <b>Rating of last checkin:</b> {{checkin.yesterdayrating}} <br>
                        <b>Notes on rating:</b> {{checkin.yesterdaynarrative}} <br>
                        {% endif %}
                        <a href="/plancheckindelete/{{checkin.id}}/{{plan.student.gid}}"><img width="30" src="/static/delete.png"></a>
                        <a href="/plancheckinedit/{{checkin.id}}/{{plan.student.gid}}"><img width="30" src="/static/edit.png"></a>
                    </div>
                    
                {% endfor %}
                </div>
                <h5 class="mt-5"><a id="themevideo"></a>What is a Theme?</h5>
                <iframe width="450" height="315" src="https://www.youtube.com/embed/NVGuFdX5guE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

                <h5>Old Themes:</h5>
                {% for theme in plan.themes %}
                    {% if theme.old %}
                        {% if plan.student.gid == session.gid or session.isadmin %}
                            <a href="/planthemeedit/{{plan.id}}/{{theme.oid}}"><img width="30" src="/static/edit.png"></a>
                            <a href="/planthemedelete/{{plan.id}}/{{theme.oid}}"><img width="30" src="/static/delete.png"></a>
                        {% endif %}
                        {{ theme.timeframe }} of {{ theme.name }}
                        {% if theme.idealoutcomes %}
                        --> Ideal Outcomes:
                            {% for io in theme.idealoutcomes %}
                                {{io.name}} |
                            {% endfor %}
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>

        {% endif %}
    </div>
</div>

{% include 'plans/planscripts.html' %}

{% endblock %}