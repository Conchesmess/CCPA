{% extends 'base.html' %}

{% block body %}

<div class="container">
    <div class="row">
        <div class="col">
            <h1>Google Roster for {{gclassname}}</h1>
            <em>Email addresses for students and parents of this class at the bottom of the page.</em>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <table class="table">
                <tr>
                    <th colspan='3'>Google Classroom Guardians</th>
                </tr>
                </tr>
                <tr>
                    <th>
                        <a href="/rostersort/{{gclassid}}" class="btn btn-primary btn-sm" role="button">Cohorts</a>

                    </th>
                    <th>Student</th>
                    <th>
                        Active Guardians<br>
                        <small><a href="/getguardians/{{gclassid}}" class="guardianUpdate">Update</a></small>
                    </th>
                    <th>Pending Invites<br><small>to someone</small></th>
                    <th>Invite These Adults<br><small>click their names</small></th>
                </tr>
            {% for stu in otdstus %}
            {% if stu['otdobject'] %}
                <tr>
                    <td>
                        {% if stu.sortCohort %}{{stu.sortCohort}}{% endif %}
                    </td>
                    <td nowrap>
                        <a href="/profile/{{stu['otdobject'].aeriesid}}">{{stu['otdobject'].afname}} {{stu['otdobject'].alname}}</a> 
                        {% if stu.updateGClasses == "True" %}
                        <a data-toggle="tooltip" data-placement="top" title="Update the student's classes" href="/addgclass/{{stu.profile.emailAddress}}/{{gclassid}}">(u)</a>
                        {% endif %}
                        <br>
                        {% if stu.cohort %}
                            {% if stu['otdobject'].cohort[:7] == "Oakland" and stu['otdobject'].cohort[13:16] == "Eng" %}
                                <small>{{stu['otdobject'].cohort[13:]}}</small>
                            {% elif stu['otdobject'].cohort[:7] == "Oakland" %}
                                <small>{{stu['otdobject'].cohort[14:]}}</small>
                            {% else %}
                                <small>{{stu['otdobject'].cohort}}</small>   
                            {% endif %}   
                        {% endif %}         
                    </td>
                    <td>
                        {% if stu['otdobject'].gclassguardians %}
                        {% for guardian in stu['otdobject'].gclassguardians.guardians %}
                            {% if guardian.guardianProfile and guardian.guardianProfile.id %}
                                {{guardian.guardianProfile.name.fullName}}
                            {% endif %}
                        {% endfor %}
                        {% endif %}
                    </td>
                    <td>
                        {% if stu['otdobject'].gclassguardianinvites %}
                        {% for invite in stu['otdobject'].gclassguardianinvites.guardianInvitations %}
                        <small>{{invite.creationTime[5:10]}}-{{invite.creationTime[2:4]}}</small> <br>
                        {% endfor %}
                        {% endif %}
                    </td>
                    <td>
                        <a href="/inviteguardians/{{stu['otdobject'].gid}}/{{gclassid}}/{{gclassname}}">
                            {% if stu['otdobject'].adults %}
                            (ot)
                            {% for adult in stu['otdobject'].adults %}
                                {{adult.fname}} {{adult.lname}}, 
                            {% endfor %}
                            <br>
                            {% elif stu['otdobject'].aadults %}
                                (a){{stu['otdobject'].aadults}}
                            {% endif %}
                        </a>
                    </td>
                </tr>
            {% else %}
                <tr><td></td><td>{{stu['profile']['name']['fullName']}} is not in OTData </td></tr>
            {% endif %}
            {% endfor %}
            </table>
            <br>
            <small>
                * Student does not have a record on OTData. Probably 'cause they are frosh on new to the school this year <br>
                (l) Student has NOT logged in to OTData <br>
                (e) Student has NOT edited their record <br>
                (a) Student has NOT added their adults to their record
            </small>
            <br> <br>
            <b>Student Emails:</b>
            
            {% set cohort = {'currCohort' : otdstus[0].sortCohort} %}
            <h3>{{otdstus[0]['otdobject'].sortCohort}}</h3>

            {% for stu in otdstus %}
                {% if stu.sortCohort != cohort.currCohort %}
                    <h3>{{stu.sortCohort}}</h3>
                    {% do cohort.update({'currCohort' : stu.sortCohort}) %}
                {% endif %}
                {{ stu.profile.emailAddress }}, 
            {% endfor %}

            <br> <br>
            <b>Parent Emails:</b> 
            {% set cohort = {'currCohort' : otdstus[0].sortCohort} %}
            <h3>{{otdstus[0].sortCohort}}</h3>
            {% for stu in otdstus %}
                {% if stu.sortCohort != cohort.currCohort %}
                    <h3>{{stu.sortCohort}}</h3>
                    {% do cohort.update({'currCohort' : stu.sortCohort}) %}
                {% endif %}
                {% if stu['otdobject'] and stu['otdobject'].adults %}
                    {% for adult in stu['otdobject'].adults %}
                        {{ adult.email }}, 
                    {% endfor %}
                {% elif stu['otdobject'] and stu['otdobject'].aadultemail %}
                    {{stu['otdobject'].aadultemail}},
                {% endif %}
            {% endfor %}        
        </div>
    </div>
</div>

{% endblock %}
